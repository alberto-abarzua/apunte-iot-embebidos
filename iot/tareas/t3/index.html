<!doctype html><html lang=es-es><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link id=syntax-style data-base=https://iot-embebidos.cl/ rel=stylesheet href=https://iot-embebidos.cl/css/github.css><link rel=preload as=font href=https://iot-embebidos.cl/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://iot-embebidos.cl/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://iot-embebidos.cl/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://iot-embebidos.cl/main.62d18b8cdfd8ead473388378e1310e7c3799824a7d5e47f494bddb4b5cd11225cbf3aa0e79184db90f39205efa9fc4797699c2335c260d4cd6f53767a879a383.css integrity="sha512-YtGLjN/Y6tRzOIN44TEOfDeZgkp9Xkf0lL3bS1zREiXL86oOeRhNuQ85IF76n8R5dpnCM1wmDUzW9TdnqHmjgw==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Tarea 3 - IoT - Embebidos</title><meta name=description content="Universidad de Chile Facultad de Ciencias Físicas y Matemáticas Departamento de Ciencias de la computacion CC5326 – Diseño de Internet de las Cosas
Profesor: Luciano Radrigan F. Auxiliar: Alberto Abarzua P.
Objetivos a cumplir: # Integrar las funcionalidades de las tareas 1 y 2: WiFi y BLE. Esto significa que un ESP32 debe ser capaz de funcionar en ambos modos, con todas las funcionalidades de ambas tareas.
El modo de funcionamiento del ESP32 debe ser controlado por el estado de la base de datos (como fue mencionado en las tareas anteriores)."><link rel=canonical href=https://iot-embebidos.cl/iot/tareas/t3/><meta property="og:locale" content="es_CL"><meta property="og:type" content="article"><meta property="og:title" content="Tarea 3"><meta property="og:description" content="Universidad de Chile Facultad de Ciencias Físicas y Matemáticas Departamento de Ciencias de la computacion CC5326 – Diseño de Internet de las Cosas
Profesor: Luciano Radrigan F. Auxiliar: Alberto Abarzua P.
Objetivos a cumplir: # Integrar las funcionalidades de las tareas 1 y 2: WiFi y BLE. Esto significa que un ESP32 debe ser capaz de funcionar en ambos modos, con todas las funcionalidades de ambas tareas.
El modo de funcionamiento del ESP32 debe ser controlado por el estado de la base de datos (como fue mencionado en las tareas anteriores)."><meta property="og:url" content="https://iot-embebidos.cl/iot/tareas/t3/"><meta property="og:site_name" content="IoT - Embebidos"><meta property="article:published_time" content="2023-08-10T14:57:17+00:00"><meta property="article:modified_time" content="2023-08-10T14:57:17+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="dccuchile"><meta name=twitter:creator content="dccuchile"><meta name=twitter:title content="Tarea 3"><meta name=twitter:description content><meta name=twitter:card content="summary"><meta name=twitter:image:alt content="Tarea 3"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://iot-embebidos.cl/#/schema/organization/1","name":"Doks","url":"https://iot-embebidos.cl/","sameAs":["https://twitter.com/getdoks","https://github.com/alberto-abarzua/apunte-iot-embebidos"],"logo":{"@type":"ImageObject","@id":"https://iot-embebidos.cl/#/schema/image/1","url":"https://iot-embebidos.cl/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://iot-embebidos.cl/#/schema/image/1"}},{"@type":"WebSite","@id":"https://iot-embebidos.cl/#/schema/website/1","url":"https://iot-embebidos.cl/","name":"IoT - Embebidos","description":"","publisher":{"@id":"https://iot-embebidos.cl/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://iot-embebidos.cl/iot/tareas/t3/","url":"https://iot-embebidos.cl/iot/tareas/t3/","name":"Tarea 3","description":"","isPartOf":{"@id":"https://iot-embebidos.cl/#/schema/website/1"},"about":{"@id":"https://iot-embebidos.cl/#/schema/organization/1"},"datePublished":"2023-08-10T14:57:17CET","dateModified":"2023-08-10T14:57:17CET","breadcrumb":{"@id":"https://iot-embebidos.cl/iot/tareas/t3/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://iot-embebidos.cl/iot/tareas/t3/#/schema/image/2"},"inLanguage":"es-CL","potentialAction":[{"@type":"ReadAction","target":["https://iot-embebidos.cl/iot/tareas/t3/"]}]},{"@type":"BreadcrumbList","@id":"https://iot-embebidos.cl/iot/tareas/t3/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://iot-embebidos.cl/","url":"https://iot-embebidos.cl/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://iot-embebidos.cl/iot/","url":"https://iot-embebidos.cl/iot/","name":"Iot"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://iot-embebidos.cl/iot/tareas/","url":"https://iot-embebidos.cl/iot/tareas/","name":"Tareas"}},{"@type":"ListItem","position":4,"item":{"@id":"https://iot-embebidos.cl/iot/tareas/t3/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://iot-embebidos.cl/iot/tareas/t3/#/schema/image/2","url":null,"contentUrl":null,"caption":"Tarea 3"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://iot-embebidos.cl/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=https://iot-embebidos.cl/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=https://iot-embebidos.cl/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://iot-embebidos.cl/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://iot-embebidos.cl/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://iot-embebidos.cl/site.webmanifest></head><body class="iot single"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=https://iot-embebidos.cl/ aria-label="IoT - Embebidos">IoT - Embebidos</a>
<button class="btn btn-link order-0 ms-auto d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasExample aria-controls=offcanvasExample><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasExample aria-labelledby=offcanvasExampleLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasExampleLabel>iot</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label=Close></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-bf89f6756d11a04ddc3bbac67a272020 aria-expanded=false>
Inicio</button><div class=collapse id=section-bf89f6756d11a04ddc3bbac67a272020><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/instalacion_esp_idf/>Instalacion ESP-IDF</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/configuracion_rasp/>Configuracion de la Raspberry Pi</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-f4a6157140dff379372aabcc57a3b08b aria-expanded=false>
ESP-IDF</button><div class=collapse id=section-f4a6157140dff379372aabcc57a3b08b><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/correr_ejemplo/>Hello World!</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/primer_programa/>Primer Programa</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/logeo/>Prints y Logeo</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/componentes/>Como dividir el codigo en componentes</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/memoria_no_volatil/>Memoria no volátil</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/deep_sleep/>Delays, Deep Sleep y Reinicio</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/como_buscar_ejemplos/>Como buscar ejemplos en ESP-IDF</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-dbbd91fb2aed7056f4aeac45a5452357 aria-expanded=false>
Wifi</button><div class=collapse id=section-dbbd91fb2aed7056f4aeac45a5452357><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/wifi/esp_wifi/>Primera Conexión WiFi</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/wifi/ejemplo_tcp/>Cliente y Server TCP</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-8de8a62c3191fb6cf61e0ac4b2b59045 aria-expanded=false>
BLUETOOTH</button><div class=collapse id=section-8de8a62c3191fb6cf61e0ac4b2b59045><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/estructura/>Estructura General</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/eventos/>Eventos</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/walkthrough/>Pasos a seguir</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-563c5c3c2429b874d2c229f241b07bc0 aria-expanded=false>
Interfaz</button><div class=collapse id=section-563c5c3c2429b874d2c229f241b07bc0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/docker/>Docker</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/react/>React</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/fastapi/>FastAPI</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-8fa33a1f2be10005d07ff40ad5c07833 aria-expanded=true>
Tareas</button><div class="collapse show" id=section-8fa33a1f2be10005d07ff40ad5c07833><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/evaluaciones/>Detalles de Evaluacion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/t1/>Tarea 1</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/t2/>Tarea 2</a></li><li><a class="docs-link rounded active" href=https://iot-embebidos.cl/iot/tareas/t3/>Tarea 3</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-7690392266ce928e0f4dea767a80b88f aria-expanded=false>
Auxiliares</button><div class=collapse id=section-7690392266ce928e0f4dea767a80b88f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/auxiliares/aux1/>Auxiliar 1 - WiFi y ESP-IDF</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/auxiliares/aux2/>Auxiliar 2 - Bluetooth Low Energy</a></li></ul></div></li></ul></nav></aside></div></div><button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=https://iot-embebidos.cl/>IoT - Embebidos</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Iot
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=https://iot-embebidos.cl/iot/inicio/intro/>Apunte</a></li><li><a class=dropdown-item href=https://iot-embebidos.cl/iot/tareas/>Tareas</a></li><li><a class=dropdown-item href=https://iot-embebidos.cl/iot/auxiliares/>Auxiliares</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Embebidos
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=https://iot-embebidos.cl/embebidos/inicio/intro/>Apunte</a></li></ul></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder aria-label autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/alberto-abarzua/apunte-iot-embebidos><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id=mode class="btn btn-link" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></div></div></nav></header></div><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-bf89f6756d11a04ddc3bbac67a272020 aria-expanded=false>
Inicio</button><div class=collapse id=section-bf89f6756d11a04ddc3bbac67a272020><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/instalacion_esp_idf/>Instalacion ESP-IDF</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/configuracion_rasp/>Configuracion de la Raspberry Pi</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-f4a6157140dff379372aabcc57a3b08b aria-expanded=false>
ESP-IDF</button><div class=collapse id=section-f4a6157140dff379372aabcc57a3b08b><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/correr_ejemplo/>Hello World!</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/primer_programa/>Primer Programa</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/logeo/>Prints y Logeo</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/componentes/>Como dividir el codigo en componentes</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/memoria_no_volatil/>Memoria no volátil</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/deep_sleep/>Delays, Deep Sleep y Reinicio</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/como_buscar_ejemplos/>Como buscar ejemplos en ESP-IDF</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-dbbd91fb2aed7056f4aeac45a5452357 aria-expanded=false>
Wifi</button><div class=collapse id=section-dbbd91fb2aed7056f4aeac45a5452357><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/wifi/esp_wifi/>Primera Conexión WiFi</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/wifi/ejemplo_tcp/>Cliente y Server TCP</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-8de8a62c3191fb6cf61e0ac4b2b59045 aria-expanded=false>
BLUETOOTH</button><div class=collapse id=section-8de8a62c3191fb6cf61e0ac4b2b59045><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/estructura/>Estructura General</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/eventos/>Eventos</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/walkthrough/>Pasos a seguir</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-563c5c3c2429b874d2c229f241b07bc0 aria-expanded=false>
Interfaz</button><div class=collapse id=section-563c5c3c2429b874d2c229f241b07bc0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/docker/>Docker</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/react/>React</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/fastapi/>FastAPI</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-8fa33a1f2be10005d07ff40ad5c07833 aria-expanded=true>
Tareas</button><div class="collapse show" id=section-8fa33a1f2be10005d07ff40ad5c07833><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/evaluaciones/>Detalles de Evaluacion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/t1/>Tarea 1</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/t2/>Tarea 2</a></li><li><a class="docs-link rounded active" href=https://iot-embebidos.cl/iot/tareas/t3/>Tarea 3</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-7690392266ce928e0f4dea767a80b88f aria-expanded=false>
Auxiliares</button><div class=collapse id=section-7690392266ce928e0f4dea767a80b88f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/auxiliares/aux1/>Auxiliar 1 - WiFi y ESP-IDF</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/auxiliares/aux2/>Auxiliar 2 - Bluetooth Low Energy</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-bf89f6756d11a04ddc3bbac67a272020 aria-expanded=false>
Inicio</button><div class=collapse id=section-bf89f6756d11a04ddc3bbac67a272020><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/instalacion_esp_idf/>Instalacion ESP-IDF</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/inicio/configuracion_rasp/>Configuracion de la Raspberry Pi</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-f4a6157140dff379372aabcc57a3b08b aria-expanded=false>
ESP-IDF</button><div class=collapse id=section-f4a6157140dff379372aabcc57a3b08b><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/correr_ejemplo/>Hello World!</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/primer_programa/>Primer Programa</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/logeo/>Prints y Logeo</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/componentes/>Como dividir el codigo en componentes</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/memoria_no_volatil/>Memoria no volátil</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/deep_sleep/>Delays, Deep Sleep y Reinicio</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/esp_idf/como_buscar_ejemplos/>Como buscar ejemplos en ESP-IDF</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-dbbd91fb2aed7056f4aeac45a5452357 aria-expanded=false>
Wifi</button><div class=collapse id=section-dbbd91fb2aed7056f4aeac45a5452357><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/wifi/esp_wifi/>Primera Conexión WiFi</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/wifi/ejemplo_tcp/>Cliente y Server TCP</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-8de8a62c3191fb6cf61e0ac4b2b59045 aria-expanded=false>
BLUETOOTH</button><div class=collapse id=section-8de8a62c3191fb6cf61e0ac4b2b59045><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/estructura/>Estructura General</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/eventos/>Eventos</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/ble/walkthrough/>Pasos a seguir</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-563c5c3c2429b874d2c229f241b07bc0 aria-expanded=false>
Interfaz</button><div class=collapse id=section-563c5c3c2429b874d2c229f241b07bc0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/intro/>Introduccion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/docker/>Docker</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/react/>React</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/interfaz/fastapi/>FastAPI</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-8fa33a1f2be10005d07ff40ad5c07833 aria-expanded=true>
Tareas</button><div class="collapse show" id=section-8fa33a1f2be10005d07ff40ad5c07833><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/evaluaciones/>Detalles de Evaluacion</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/t1/>Tarea 1</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/tareas/t2/>Tarea 2</a></li><li><a class="docs-link rounded active" href=https://iot-embebidos.cl/iot/tareas/t3/>Tarea 3</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-7690392266ce928e0f4dea767a80b88f aria-expanded=false>
Auxiliares</button><div class=collapse id=section-7690392266ce928e0f4dea767a80b88f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/auxiliares/aux1/>Auxiliar 1 - WiFi y ESP-IDF</a></li><li><a class="docs-link rounded" href=https://iot-embebidos.cl/iot/auxiliares/aux2/>Auxiliar 2 - Bluetooth Low Energy</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span></span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#objetivos-a-cumplir>Objetivos a cumplir:</a></li><li><a href=#funcionamiento>Funcionamiento</a><ul><li><a href=#ble>BLE:</a></li><li><a href=#wifi>WiFi:</a></li><li><a href=#flujo-general>Flujo General</a></li></ul></li><li><a href=#encabezados-de-los-paquetes>Encabezados de los paquetes</a></li><li><a href=#protocolos-de-envío>Protocolos de envío</a></li><li><a href=#generacion-de-datos>Generacion de datos</a></li><li><a href=#base-de-datos>Base de Datos</a></li><li><a href=#entrega>Entrega</a></li><li><a href=#recomendaciones>Recomendaciones</a></li><li><a href=#plantilla>Plantilla</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3></h3><nav id=TableOfContents><ul><li><a href=#objetivos-a-cumplir>Objetivos a cumplir:</a></li><li><a href=#funcionamiento>Funcionamiento</a><ul><li><a href=#ble>BLE:</a></li><li><a href=#wifi>WiFi:</a></li><li><a href=#flujo-general>Flujo General</a></li></ul></li><li><a href=#encabezados-de-los-paquetes>Encabezados de los paquetes</a></li><li><a href=#protocolos-de-envío>Protocolos de envío</a></li><li><a href=#generacion-de-datos>Generacion de datos</a></li><li><a href=#base-de-datos>Base de Datos</a></li><li><a href=#entrega>Entrega</a></li><li><a href=#recomendaciones>Recomendaciones</a></li><li><a href=#plantilla>Plantilla</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Tarea 3</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span></span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#objetivos-a-cumplir>Objetivos a cumplir:</a></li><li><a href=#funcionamiento>Funcionamiento</a><ul><li><a href=#ble>BLE:</a></li><li><a href=#wifi>WiFi:</a></li><li><a href=#flujo-general>Flujo General</a></li></ul></li><li><a href=#encabezados-de-los-paquetes>Encabezados de los paquetes</a></li><li><a href=#protocolos-de-envío>Protocolos de envío</a></li><li><a href=#generacion-de-datos>Generacion de datos</a></li><li><a href=#base-de-datos>Base de Datos</a></li><li><a href=#entrega>Entrega</a></li><li><a href=#recomendaciones>Recomendaciones</a></li><li><a href=#plantilla>Plantilla</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3></h3><nav id=TableOfContents><ul><li><a href=#objetivos-a-cumplir>Objetivos a cumplir:</a></li><li><a href=#funcionamiento>Funcionamiento</a><ul><li><a href=#ble>BLE:</a></li><li><a href=#wifi>WiFi:</a></li><li><a href=#flujo-general>Flujo General</a></li></ul></li><li><a href=#encabezados-de-los-paquetes>Encabezados de los paquetes</a></li><li><a href=#protocolos-de-envío>Protocolos de envío</a></li><li><a href=#generacion-de-datos>Generacion de datos</a></li><li><a href=#base-de-datos>Base de Datos</a></li><li><a href=#entrega>Entrega</a></li><li><a href=#recomendaciones>Recomendaciones</a></li><li><a href=#plantilla>Plantilla</a></li></ul></nav></div></nav><p><em>Universidad de Chile</em>
<em>Facultad de Ciencias Físicas y Matemáticas Departamento de Ciencias de la computacion</em>
<em>CC5326 – Diseño de Internet de las Cosas</em></p><hr><p><strong>Profesor:</strong> Luciano Radrigan F.
<strong>Auxiliar:</strong> Alberto Abarzua P.</p><h2 id=objetivos-a-cumplir>Objetivos a cumplir: <a href=#objetivos-a-cumplir class=anchor aria-hidden=true>#</a></h2><ul><li><p><input disabled type=checkbox> Integrar las funcionalidades de las tareas 1 y 2: WiFi y BLE. Esto significa que un ESP32 debe ser capaz de funcionar en ambos modos, con todas las funcionalidades de ambas tareas.</p></li><li><p><input disabled type=checkbox> El modo de funcionamiento del ESP32 debe ser controlado por el estado de la base de datos (como fue mencionado en las tareas anteriores). Esto será crucial para esta tarea.</p></li><li><p><input disabled type=checkbox> Los cambios en la base de datos deberán ser reflejados en el ESP32 y en el funcionamiento del sistema.</p></li><li><p><input disabled type=checkbox> La base de datos debe ser accedida desde Python únicamente (no se permitirá modificarla directamente usando adminer o pgadmin).</p></li><li><p><input disabled type=checkbox> Deben crear una API HTTP que permita (se dará una plantilla utilizando FastAPI):</p><ul><li><code>Acceder a la configuración actual</code></li><li><code>Modificar la configuración actual</code></li><li><code>Acceder a los datos generados por las ESP32</code></li></ul></li><li><p><input disabled type=checkbox> Una interfaz web la cual permita (se dará una plantilla usando React):</p><ul><li><code>Visualizar los datos generados por las ESP32</code>: Para esto, deben generar gráficos que se actualicen en tiempo real; no se permitirá mostrar datos en una tabla.</li><li><code>Modificar la configuración actual</code></li></ul></li></ul><h2 id=funcionamiento>Funcionamiento <a href=#funcionamiento class=anchor aria-hidden=true>#</a></h2><p>Todo debe funcionar según la configuración de la base de datos. Tendremos los 2 medios de comunicación:</p><h3 id=ble>BLE: <a href=#ble class=anchor aria-hidden=true>#</a></h3><ul><li>Protocolos de datos: 0, 1, 2 y 3</li><li>Transport Layer:<ul><li><strong>BLE Continuo:</strong> Se envían los datos de forma continua, sin pausas.</li><li><strong>BLE Discontinuo:</strong> Entre cada envio de datos existe un perido de duracion <code>discontious_time</code> (configurable en la base de datos) donde la ESP32 debe entrar en modo deep sleep.</li></ul></li></ul><h3 id=wifi>WiFi: <a href=#wifi class=anchor aria-hidden=true>#</a></h3><ul><li>Protocolos de datos: 0, 1, 2, 3, 4</li><li>Transport Layer:<ul><li><strong>TCP:</strong> Se envían los datos a través de TCP, entre cada envio de datos existe un perido de duracion <code>discontious_time</code> (configurable en la base de datos) donde la ESP32 debe entrar en modo deep sleep.</li><li><strong>UDP:</strong> Se envían los datos a través de UDP.</li></ul></li></ul><p>Se solicita que según los cambios en la base de datos, puedan cambiar tanto el medio de comunicación (BLE o WiFi) como el protocolo de datos y el transport layer.</p><p>Por simplicidad, se tendrá un estado de inicio (llamaremos estado a la configuración de medio, protocolo y transport layer); se debe iniciar el funcionamiento usando BLE Continuo y el protocolo 0. Luego, se podrá cambiar el estado a través de la API HTTP.</p><p>Luego, se debe poder cambiar desde cualquier estado a cualquier otro estado, por ejemplo:</p><ul><li>BLE Continuo y protocolo 0 a BLE Discontinuo y protocolo 1</li><li>BLE Continuo y protocolo 0 a TCP y protocolo 4</li><li>TCP y protocolo 4 a UDP y protocolo 3</li><li>etc &mldr;</li></ul><h3 id=flujo-general>Flujo General <a href=#flujo-general class=anchor aria-hidden=true>#</a></h3><ol><li><p>Se inicia el sistema con BLE Continuo y protocolo 0, y se realiza una conexión entre el ESP32 y la Raspberry Pi. Se envían los datos según el protocolo 0.</p></li><li><p>En la interfaz web, se pueden ver los datos adquiridos por el ESP32 y se puede cambiar el estado de la base de datos a TCP y protocolo 4. (Esto realiza una llamada a la API HTTP, la cual interactúa con la base de datos).</p></li><li><p>En el siguiente intercambio de datos entre el ESP32 y la Raspberry Pi, su código en Python detecta el cambio en la base de datos y envía la configuración actualizada a la ESP32.</p></li><li><p>El ESP32 recibe la configuración actualizada y cambia su medio de comunicación a TCP y su protocolo de datos a 4. Luego, envía los datos según el protocolo 4.</p></li><li><p>Se ven realizados los cambios en la interfaz web y se vuelve al paso 2 para realizar otro cambio.</p></li></ol><p>Aquí es importante notar que el ESP no puede trabajar con WiFi y BLE al mismo tiempo, por lo que se debe cerrar la conexión BLE para poder trabajar con WiFi y viceversa. Para esto, les puede ser útil simplemente reiniciar el ESP32 cuando se cambie el estado de la base de datos e inicializarla con el nuevo estado. Con esto surge un nuevo problema: ¿dónde queda la información de qué protocolo usar después de reiniciar el ESP32?</p><p>Para esto les será útil el uso de la memoria no volátil (en el apunte se explica cómo utilizarla). De esta forma, cuando al ESP32 le llegue una configuración nueva, la guardará en la memoria no volátil y, cuando se reinicie el ESP32, esta leerá la configuración guardada en la memoria no volátil y se inicializará con esta.</p><h2 id=encabezados-de-los-paquetes>Encabezados de los paquetes <a href=#encabezados-de-los-paquetes class=anchor aria-hidden=true>#</a></h2><p>Cada paquete deberá contar con su propio encabezado, que incluirá la siguiente información. Este será común para todos los protocolos de envío:</p><table><thead><tr><th>Header</th><th>Data</th></tr></thead><tbody><tr><td><code>&lt;2 bytes></code></td><td>ID <em>(ID unico del mensaje)</em></td></tr><tr><td><code>&lt;6 bytes></code></td><td>Device MAC</td></tr><tr><td><code>&lt;1 bytes></code></td><td>Transport Layer <em>(TCP o UDP)</em></td></tr><tr><td><code>&lt;1 bytes></code></td><td>ID Protocol</td></tr><tr><td><code>&lt;2 bytes></code></td><td>Length <em>(Headers + Body)</em></td></tr></tbody></table><h2 id=protocolos-de-envío>Protocolos de envío <a href=#protocolos-de-env%c3%ado class=anchor aria-hidden=true>#</a></h2><p>Los protocolos de envío determinan la forma y el contenido que deben seguir los paquetes enviados por los ESP32. Estos paquetes se enviarán a través de TCP o UDP, dependiendo de la configuración asignada a la ESP32, la cual se encuentra en la base de datos.</p><table><thead><tr><th>Valores</th><th>Protocolo 0</th><th>Protocolo 1</th><th>Protocolo 2</th><th>Protocolo 3</th></tr></thead><tbody><tr><td>Headers</td><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr><tr><td><code>&lt;1 bytes></code> Data 1</td><td>Batt level</td><td>Batt level</td><td>Batt level</td><td>Batt level</td></tr><tr><td><code>&lt;4 bytes></code> Data 2</td><td></td><td>Timestamp</td><td>Timestamp</td><td>Timestamp</td></tr><tr><td><code>&lt;1 bytes></code> Data 3</td><td></td><td></td><td>Temp</td><td>Temp</td></tr><tr><td><code>&lt;4 bytes></code> Data 4</td><td></td><td></td><td>Press</td><td>Press</td></tr><tr><td><code>&lt;1 bytes></code> Data 5</td><td></td><td></td><td>Hum</td><td>Hum</td></tr><tr><td><code>&lt;4 bytes></code> Data 6</td><td></td><td></td><td>Co</td><td>Co</td></tr><tr><td><code>&lt;4 bytes></code> Data 7</td><td></td><td></td><td></td><td>RMS</td></tr><tr><td><code>&lt;4 bytes></code> Data 8</td><td></td><td></td><td></td><td>Amp x</td></tr><tr><td><code>&lt;4 bytes></code> Data 9</td><td></td><td></td><td></td><td>Frec x</td></tr><tr><td><code>&lt;4 bytes></code> Data 10</td><td></td><td></td><td></td><td>Amp y</td></tr><tr><td><code>&lt;4 bytes></code> Data 11</td><td></td><td></td><td></td><td>Frec y</td></tr><tr><td><code>&lt;4 bytes></code> Data 12</td><td></td><td></td><td></td><td>Amp z</td></tr><tr><td><code>&lt;4 bytes></code> Data 13</td><td></td><td></td><td></td><td>Frec z</td></tr></tbody></table><table><thead><tr><th>Valores</th><th>Protocolo 4</th></tr></thead><tbody><tr><td>Headers</td><td>&mldr;</td></tr><tr><td><code>&lt;1 bytes></code> Data 1</td><td>Batt level</td></tr><tr><td><code>&lt;4 bytes></code> Data 2</td><td>Timestamp</td></tr><tr><td><code>&lt;1 bytes></code> Data 3</td><td>Temp</td></tr><tr><td><code>&lt;4 bytes></code> Data 4</td><td>Press</td></tr><tr><td><code>&lt;1 bytes></code> Data 5</td><td>Hum</td></tr><tr><td><code>&lt;4 bytes></code> Data 6</td><td>Co</td></tr><tr><td><code>&lt;8000 bytes></code> Data 7</td><td>Acc x - <code>Array 2000 floats</code></td></tr><tr><td><code>&lt;8000 bytes></code> Data 8</td><td>Acc y - <code>Array 2000 floats</code></td></tr><tr><td><code>&lt;8000 bytes></code> Data 9</td><td>Acc z - <code>Array 2000 floats</code></td></tr><tr><td><code>&lt;8000 bytes></code> Data 10</td><td>Rgyr x- <code>Array 2000 floats</code></td></tr><tr><td><code>&lt;8000 bytes></code> Data 11</td><td>Rgyr y- <code>Array 2000 floats</code></td></tr><tr><td><code>&lt;8000 bytes></code> Data 12</td><td>Rgyr z - <code>Array 2000 floats</code></td></tr></tbody></table><p>En resumen, cada protocolo de envío tiene la estructura <code>Headers + Body</code>. El &ldquo;Body&rdquo; contiene los datos que se enviarán, los cuales están especificados en las tablas anteriores. Este &ldquo;Body&rdquo; depende del protocolo de envío que se haya configurado en la base de datos.</p><h2 id=generacion-de-datos>Generacion de datos <a href=#generacion-de-datos class=anchor aria-hidden=true>#</a></h2><p><strong>Acceloremeter_kpi</strong>: Representa un sensor de vibraciones que mide en los tres ejes y calcula su promedio mediante la fórmula de la raíz cuadrada de la media (RMS). Los valores son float y se generan con las siguientes fórmulas:</p><ul><li><code>Ampx</code>: Valores aleatorios entre 0.0059 y 0.12</li><li><code>Freqx</code>: Valores aleatorios entre 29.0 y 31.0</li><li><code>Ampy</code>: Valores aleatorios entre 0.0041 y 0.11</li><li><code>Freqy</code>: Valores aleatorios entre 59.0 y 61.0</li><li><code>Ampz</code>: Valores aleatorios entre 0.008 y 0.15</li><li><code>Freqz</code>: Valores aleatorios entre 89.0 y 91.0</li><li><code>RMS</code>: sqrt{(Ampx^2 + Ampy^2 + Ampz^2)}</li></ul><p><strong>Acceloremeter_Sensor</strong>: Un medidor de aceleración que genera un vector de 2000 datos por eje (X,Y,Z) para sus dos parámetros: aceleración y velocidad angular. Los datos son float y se generan con las siguientes fórmulas:</p><ul><li><code>Acc_X</code>: Valores aleatorios entre -16.0 y 16.0</li><li><code>Acc_Y</code>: Valores aleatorios entre -16.0 y 16.0</li><li><code>Acc_Z</code>: Valores aleatorios entre -16.0 y 16.0</li><li><code>Rgyr_X</code>: Valores aleatorios entre -1000 y 1000</li><li><code>Rgyr_Y</code>: Valores aleatorios entre -1000 y 1000</li><li><code>Rgyr_Z</code>: Valores aleatorios entre -1000 y 1000</li></ul><p><strong>THPC_Sensor (Temperatura-Humedad-Presión-CO)</strong>: Representa un sensor de cada uno de estos aspectos. Los valores son enteros, excepto para CO que es float.</p><ul><li><code>Temp</code>: Valor aleatorio entre 5 y 30</li><li><code>Hum</code>: Valor aleatorio entre 30 y 80</li><li><code>Pres</code>: Valor aleatorio entre 1000 y 1200</li><li><code>CO</code>: Valor aleatorio entre 30 y 200</li></ul><p><strong>Batt_Sensor</strong>: Representa el nivel de batería del aparato. El valor es un <code>u_int8</code> aleatorio entre 1 y 100.</p><h2 id=base-de-datos>Base de Datos <a href=#base-de-datos class=anchor aria-hidden=true>#</a></h2><p>La base de datos debe contener las siguientes tablas (las mismas que en la tarea anterior a excepción de la tabla <code>Configuración</code>)):</p><ul><li><p><strong>Datos:</strong> Esta tabla almacenará todos los datos recibidos, incluyendo un sello de tiempo (<code>timestamp</code>) y el identificador del dispositivo (<code>Id_device</code> y <code>MAC</code>).</p></li><li><p><strong>Logs:</strong> Esta tabla registrará la información de cada conexión recibida por el servidor, incluyendo el <code>ID_device</code>, el tipo de capa de transporte (<code>Transport_Layer</code>), el protocolo utilizado y su <code>timestamp</code>.</p></li><li><p><strong>Configuración:</strong>: Esta tabla almacenará la configuración actual de la ESP32, es decir el estado del sistema (medio de comunicación, protocolo de envío y capa de transporte)
y configuraciones para su funcionamiento. Esta tabla debe ser modificada por la API HTTP.</p><ul><li><code>ID_protocol</code>: Protocolo de envío</li><li><code>Transport_Layer</code>: BLE Continuo, BLE Discontinuo, TCP o UDP</li><li><code>TCP_PORT</code>: Puerto del servidor TCP</li><li><code>UDP_PORT</code>: Puerto del servidor UDP</li><li><code>Gyro_sensibility</code>: Sensibilidad del giroscopio</li><li><code>Acc_sensibility</code>: Sensibilidad del acelerómetro</li><li><code>Acc_sampling_rate</code>: Frecuencia de muestreo del acelerómetro</li><li><code>Gyro_sampling_rate</code>: Frecuencia de muestreo del giroscopio</li><li><code>Discontinous_time</code>: Tiempo de espera entre paquetes en modo BLE discontinuo y TCP</li><li><code>Host_ip_address</code>: Dirección IP de la Raspberry Pi</li><li><code>Wifi_ssid</code>: Nombre de la red WiFi</li><li><code>Wifi_password</code>: Contraseña de la red WiFi</li></ul></li><li><p><strong>Loss:</strong> Esta tabla almacenará el tiempo de demora en la comunicación (tiempo desde el momento de envío hasta el momento de escritura en la base de datos, calculado usando la diferencia entre esos <code>timestamps</code>) y la cantidad de pérdida de paquetes (<code>packet loss</code>) en bytes para cada comunicación que haya ocurrido.</p></li></ul><h2 id=entrega>Entrega <a href=#entrega class=anchor aria-hidden=true>#</a></h2><ol><li><p>Una demostración en vivo del funcionamiento del sistema el <em>[dia por definir]</em>.</p></li><li><p>En el readme de su repositorio de Git, agregar una descripción de la tarea, los integrantes del grupo y una explicación de lo realizado.</p></li><li><p>Subir el código a U-cursos (Plazo en U-cursos). Si es posible, incluya un enlace a un repositorio de Git donde se trabajó en la tarea.</p></li></ol><h2 id=recomendaciones>Recomendaciones <a href=#recomendaciones class=anchor aria-hidden=true>#</a></h2><ul><li><p>Es importante que separen la logica en 3 componentes, de esta forma podran trabajar de forma mas ordenada y eficiente, de tal forma que la base de datos siempre sea la fuente de verdad y los otros componentes solo se encarguen de leerla y modificarla.</p><ul><li>La base de datos</li><li>La Interfaz Web y la API HTTP</li><li>Su servidor/cliente en python con la ESP32</li></ul></li><li><p>El uso de la memoria no volatil es fundamental para poder guardar la configuracion de la ESP32 y que esta se mantenga luego de un reinicio.</p></li><li><p>Cualquier duda que tengan, no duden en preguntar al cuerpo docente.</p></li></ul><h2 id=plantilla>Plantilla <a href=#plantilla class=anchor aria-hidden=true>#</a></h2><p>Dentro del <code>README.md</code> (Leanlo!) de la plantilla se encuentra la informacion necesaria para poder utilizarla.</p><ul><li><a href=https://github.com/alberto-abarzua/apunte-iot-embebidos/tree/main/ejemplos/plantilla_t3.zip>Plantilla de la tarea</a></li></ul><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=https://iot-embebidos.cl/iot/wifi/ejemplo_tcp/><div class="card my-1"><div class="card-body py-2">&larr; Cliente y Server TCP</div></div></a><a class=ms-auto href=https://iot-embebidos.cl/iot/ble/eventos/><div class="card my-1"><div class="card-body py-2">Eventos &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://gohugo.io/>Hugo</a>, and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://iot-embebidos.cl/js/bootstrap.min.49deee76074d4074d37d54619d509b36839e1aa4ebf6698c543b5d5645b355076b9713429c9a308a3b216c208da0aa3507af100fa137063b1e6aca3cc2259e27.js integrity="sha512-Sd7udgdNQHTTfVRhnVCbNoOeGqTr9mmMVDtdVkWzVQdrlxNCnJowijshbCCNoKo1B68QD6E3Bjseaso8wiWeJw==" crossorigin=anonymous defer></script>
<script src=https://iot-embebidos.cl/js/highlight.min.b466b1b8ede2d0a4056afb878082ce76615d24638842550085d331e7ccb5938936c655c07063b5e7fafa7527cc0d72ad4460b7057e07ac861bfbf474008de1e5.js integrity="sha512-tGaxuO3i0KQFavuHgILOdmFdJGOIQlUAhdMx58y1k4k2xlXAcGO15/r6dSfMDXKtRGC3BX4HrIYb+/R0AI3h5Q==" crossorigin=anonymous defer></script>
<script src=https://iot-embebidos.cl/main.min.3b95160a7aa65f9fd19ec85a774deb4fc4b4f15d11d7f77a48d8b9b3495ee5bb97606ecb840c119c358980f0920730a504065c0a66e8521ffb533674d7720117.js integrity="sha512-O5UWCnqmX5/Rnshad03rT8S08V0R1/d6SNi5s0le5buXYG7LhAwRnDWJgPCSBzClBAZcCmboUh/7UzZ013IBFw==" crossorigin=anonymous defer></script>
<script src=https://iot-embebidos.cl/index.min.4ae26272486ea46c5bb0bed7a0b434a91b05e8182cfb839a405dd4e647b05ce5d76d401a5103d822d3b1589fc56335cd372b712d97085b8d89aebf244b1b5501.js integrity="sha512-SuJickhupGxbsL7XoLQ0qRsF6Bgs+4OaQF3U5kewXOXXbUAaUQPYItOxWJ/FYzXNNytxLZcIW42Jrr8kSxtVAQ==" crossorigin=anonymous defer></script></body></html>